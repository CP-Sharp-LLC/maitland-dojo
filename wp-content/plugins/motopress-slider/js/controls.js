(function(d,c){c.FormController=can.Control.extend({},{id:null,element:null,optionControllers:{},settings:{},dependency:{},disabled_dependency:{},optionsContainer:"page",dependencyTypes:{dependency:"visibility",disabled_dependency:"disabled"},init:function(a,b){this.element=a;this.settings=b;this.id=c.Vars.page.id;this.dependency={};this.disabled_dependency={};this.setOptionControllers();this.updateOptionControllers();this.showAllDependencies();can.trigger(this,"initFinish")},setOptionControllers:function(){var a=
this,b=a.element.find(".mpsl-option"),e={showErrorType:this.settings.showErrorType};d.each(b,function(b,c){var g=a.createOptionController(d(c),e),l=g.getName();a.optionControllers[l]=g})},updateOptionControllers:function(){var a=this;d.each(c.Vars[this.optionsContainer].options,function(b,e){e.hasOwnProperty("actions")&&d.each(e.actions,function(e,c){a.optionControllers.hasOwnProperty(b)&&a.optionControllers[b].addAction(e,c)});e.hasOwnProperty("helpers")&&d.each(e.helpers,function(e,c){a.optionControllers.hasOwnProperty(b)&&
a.optionControllers[b].addHelper(c,a.optionControllers[c])});e.hasOwnProperty("options")&&d.each(e.options,function(b,e){e.hasOwnProperty("helpers")&&d.each(e.helpers,function(e,c){a.optionControllers.hasOwnProperty(b)&&a.optionControllers[b].addHelper(c,a.optionControllers[c])})})})},createOptionController:function(a,b){var e;e=a.attr("data-mpsl-option-type");var f=a.hasClass("mpsl-nested-option"),h="";f&&(h=a.attr("data-parent-name"),h=this.optionControllers[h]);d.extend(b,{isNested:f,parentOption:f?
h:{},form:this});switch(e){case "text":e=new c.TextControl(d(a),b);break;case "number":e=new c.NumberControl(d(a),b);break;case "textarea":e=new c.TextareaControl(d(a),b);break;case "tiny_mce":e=new c.TinyMCEControl(d(a),b);break;case "checkbox":e=new c.CheckboxControl(d(a),b);break;case "select":e=new c.SelectControl(d(a),b);break;case "radio_group":e=new c.RadioGroupControl(d(a),b);break;case "radio_buttons":e=new c.RadioButtonsControl(d(a),b);break;case "button_group":e=new c.ButtonGroupControl(d(a),
b);break;case "action_group":e=new c.ActionGroupControl(d(a),b);break;case "pretty_select":e=new c.PrettySelectControl(d(a),b);break;case "library_image":e=new c.ImageLibraryControl(d(a),b);break;case "library_video":e=new c.VideoLibraryControl(d(a),b);break;case "image_url":e=new c.ImageUrlControl(d(a),b);break;case "hidden":e=new c.HiddenControl(d(a),b);break;case "alias":e=new c.AliasControl(d(a),b);break;case "shortcode":e=new c.ShortcodeControl(d(a),b);break;case "align_table":e=new c.AlignTableControl(d(a),
b);break;case "datepicker":e=new c.DatePicker(d(a),b);break;case "codemirror":e=new c.CodeMirrorControl(d(a),b);break;case "style_editor":e=new c.StyleEditorControl(d(a),b);break;case "multiple":e=new c.MultipleControl(d(a),b);break;case "font_picker":e=new c.FontPickerControl(d(a),b);break;case "color_picker":e=new c.ColorPickerControl(d(a),b);break;case "text_shadow":e=new c.TextShadowControl(d(a),b);break;case "animation_control":e=new c.AnimationControl(d(a),b);break;default:e=new c.OptionControl(d(a),
b)}this.addDependency(e);return e},addDependency:function(a,b){var e=this;if("undefined"===typeof b)return d.each(this.dependencyTypes,function(b){e.addDependency(a,b)}),!1;var c=a.getDependency(b);"undefined"!==typeof c&&(-1<d.inArray(typeof c.value,["array","object"])&&(c.value=[c.operator,c.value.join(",")].join(";")),this[b][c.parameter]||(this[b][c.parameter]={}),this[b][c.parameter][c.value]||(this[b][c.parameter][c.value]=[]),this[b][c.parameter][c.value].push(a.getName()))},showDependencedOptions:function(a,
b){var c=this;if("undefined"===typeof b)return d.each(this.dependencyTypes,function(b){c.showDependencedOptions(a,b)}),!1;var f,h,g=!1,l=c.dependencyTypes[b];if(c[b].hasOwnProperty(a)){var n=c.optionControllers[a],m=n.getValue();d.isArray(m)||(m=[m]);d.each(c[b][a],function(k,q){k=k.split(";");h=k[0];k=k[1].split(",");d.each(k,function(a,b){k[a]=n.fixValueType(b)});d.each(q,function(n,p){g=!1;c.optionControllers[a].isOptionEnabled(l)&&(f=[],d.each(m,function(a,b){f[a]=d.grep(k,function(a){return a==
b});f[a]=!("!IN"===h?f[a].length:!f[a].length)}),"IN"===h?g=-1<d.inArray(!0,f):"!IN"===h?g=-1===d.inArray(!1,f):(g=d.grep(f,function(a){return!0===a}),g=g.length===k.length&&-1===d.inArray(!1,f)));c.optionControllers[p][g?"enable":"disable"](l);c.showDependencedOptions(c.optionControllers[p].getName(),b)})})}},showAllDependencies:function(){var a=this;d.each(this.dependencyTypes,function(b,c){d.each(a[b],function(c,e){a.showDependencedOptions(c,b)})})},verifyOptions:function(){var a=!0;d.each(this.optionControllers,
function(b,c){if(c.isOptionEnabled()&&c.isOptionEnabled("disabled")&&!c.verifyOption())return a=!1});return a},getFormData:function(){var a={};d.each(this.optionControllers,function(b,c){var d=c.getGroupName();"undefined"===typeof a[d]&&(a[d]={});c.isOptionEnabled()&&(a[d][b]=c.getValue())});return a},getOptionsList:function(){var a={};d.each(this.optionControllers,function(b,c){c.isOptionEnabled()&&(a[b]=c.getValue())});return a},getOption:function(a){return"undefined"===typeof this.optionControllers[a]?
!1:this.optionControllers[a]},render:function(){}});c.OptionControl=can.Control.extend({defaults:{}},{controls:[],helpers:{},actions:{},element:null,form:null,isNested:!1,parentOption:{},childOptions:{},showErrorType:"popup",containerType:"",setup:function(a,b){this._super(a,b);this.setElement(a)},init:function(a,b){this.elementWrapper=a.closest(".mpsl-option-wrapper");a.closest(".mpsl_layers_wrapper").length?this.containerType="layer":a.closest(".mpsl-style-editor-wrapper").length?this.containerType=
"preset":this.containerType="page";this.name=a.attr("data-name");this.group=a.closest("[data-group]").attr("data-group");this.helpers={};this.actions={};this.form=b.form;this.isNested=b.isNested;this.parentOption=b.parentOption;this.childOptions={};this.isNested&&this.parentOption.addChild(this);b.hasOwnProperty("showErrorType")&&(this.showErrorType=b.showErrorType);b.isNested?this.settings=c.Vars[this.containerType].grouped_options[this.group].options[this.parentOption.getName()].options[this.name]:
(this.settings=c.Vars[this.containerType].grouped_options[this.group].options[this.name],this.isMultiValue=c.Vars[this.containerType].grouped_options[this.group].options[this.name].hasOwnProperty("list"));this.disabledEnabled=this.enabled=this.valid=!0},setElement:function(a){this.element=a.find("input")},addChild:function(a){this.childOptions[a.getName()]=a},getName:function(){return this.name},getLabel:function(){return this.settings.hasOwnProperty("label")&&this.settings.label?this.settings.label:
this.settings.hasOwnProperty("label2")&&this.settings.label2?this.settings.label2:this.getName()},getDependency:function(a){return this.settings[a]},getGroupName:function(){return this.group},getValue:function(){return this.element.val()},setValue:function(a,b){this.element.val(a);"undefined"!==typeof b&&b?can.trigger(this.element,"silentChange"):this.element.change()},showError:function(a){c.Functions.showMessage(a,c.Functions.MSG_ERROR_TYPE)},hideError:function(){},verifyOption:function(){return!0},
isValid:function(){return this.valid},isOptionEnabled:function(a){switch("undefined"===typeof a?"visibility":a){case "visibility":return this.enabled;case "disabled":return this.disabledEnabled}return!1},enable:function(a){switch("undefined"===typeof a?"visibility":a){case "visibility":this.enabled=!0;this.elementWrapper.removeClass("mpsl-dependency-hide");break;case "disabled":this.disabledEnabled=!0,this.element.removeAttr("disabled")}},disable:function(a){switch("undefined"===typeof a?"visibility":
a){case "visibility":this.enabled=!1;this.elementWrapper.addClass("mpsl-dependency-hide");break;case "disabled":this.disabledEnabled=!1,this.element.attr("disabled","disabled")}},linkForm:function(a){this.form=a},addHelper:function(a,b){this.helpers[a]=b},addAction:function(a,b){var c=this;this.actions[a]={};d.each(b,function(b,d){c.actions[a][b]={};c.actions[a][b].ctrl=c.form.optionControllers[b];c.actions[a][b].value=d})},fixValueType:function(a){return a},change:function(){this.form.showDependencedOptions(this.getName());
this.verifyOption()&&this.form.render()},silentChange:function(){}});c.TextControl=c.OptionControl.extend({},{verifyOption:function(){if(this.settings.hasOwnProperty("required")&&1==this.settings.required){if(""===this.getValue())return this.showError(c.Vars.lang.emptyInputError.replace("%s",this.getLabel())),!1}else this.hideError();return!0}});c.NumberControl=c.OptionControl.extend({},{verifyOption:function(){var a=this.getValue();if(!a)return this.settings.hasOwnProperty("required")&&this.settings.required?
(this.showError(c.Vars.lang.emptyInputError.replace("%s",this.getLabel())),!1):!0;if(!(new RegExp(/^[+-]?(\d+[.])?\d+$/)).test(a))return this.showError(c.Vars.lang.validate_digitals_only.replace("%s",this.getLabel())),!1;if(this.settings.hasOwnProperty("min")&&a<this.settings.min)return this.showError(c.Vars.lang.validate_less_min.replace("%s",this.getLabel()).replace("%d",this.settings.min)),!1;if(this.settings.hasOwnProperty("max")&&a>this.settings.max)return this.showError(c.Vars.lang.validate_greater_max.replace("%s",
this.getLabel()).replace("%d",this.settings.max)),!1;this.hideError();return!0},"input keydown":function(a,b){var c=this.getValue(),c=!isNaN(parseFloat(c))&&isFinite(c)?parseFloat(c):0;"38"==b.keyCode?this.setValue(c+1):"40"==b.keyCode&&this.setValue(c-1)}});c.TextareaControl=c.OptionControl.extend({},{setElement:function(a){this.element=a.find("textarea")}});c.TinyMCEControl=c.OptionControl.extend({},{ready:null,editorWrapper:null,editorArea:null,init:function(a,b){this._super(a,b);this.editorWrapper=
a.find(".wp-editor-wrap");this.editorArea=a.find("#mpsl-text");this.initTinyMCE()},initTinyMCE:function(){var a=this,b=c.Vars.settings.alt_prefix+a.name,e=d.Deferred();this.ready=e.promise();if("4"===tinyMCE.majorVersion)tinyMCE.on("AddEditor",function(a){if(a.editor.id===b)a.editor.on("init",function(b){e.resolve(a.editor)})});else tinyMCE.onAddEditor.add(function(a,c){c.editorId===b&&c.onInit.add(function(a){e.resolve(a)})});d.when(a.ready).then(function(b){a.editor=b;a.element.find(".wp-switch-editor.switch-tmce").on("click",
a.proxy("change"));a.editorArea.on("change keyup paste blur",a.proxy("change"));if("4"===tinyMCE.majorVersion)b.on("keyup change",a.proxy("change"));else a.editor.onKeyUp.add(a.proxy("change")),a.editor.onChange.add(a.proxy("change"));a.editor.addCommand("mpsl_post_macros",a.proxy("change"))})},getValue:function(){return this.editor?this.editorWrapper.hasClass("tmce-active")?this.editor.getContent():this.editorArea.val():""},setValue:function(a,b){b="undefined"!==typeof b?b:!1;this.editor&&(this.editor.undoManager.clear(),
this.editorWrapper.hasClass("tmce-active")?this.editor.setContent(a):this.editorArea.val(a),b||this.element.change())},setElement:function(a){this.element=a}});c.CodeMirrorControl=c.TextareaControl.extend({refreshEditors:function(a){a="undefined"===typeof a?d("body"):a;a.length&&(a.hasClass("mpsl-option-codemirror")?a.find(".CodeMirror").get(0).CodeMirror.refresh():a.find(".mpsl-option-codemirror .CodeMirror").each(function(){this.CodeMirror.refresh()}))}},{codeMirrorElement:{},init:function(a,b){this._super(a,
b);this.CodeMirrorObj=CodeMirror.fromTextArea(this.element.get(0),{lineNumbers:!0,mode:"undefined"!==typeof this.settings.mode?this.settings.mode:null});this.codeMirrorElement=this.element.next();this.CodeMirrorObj.on("change",this.proxy("onCodemirrorChange"))},onCodemirrorChange:function(){var a=this;if(this.codeMirrorElement.is(":visible"))var b=setTimeout(function(){a.element.change();clearTimeout(b)},1)},getValue:function(){return this.CodeMirrorObj.getValue()},setValue:function(a,b){this.CodeMirrorObj.setValue(a);
"undefined"!==typeof b&&b||this.element.change()},enable:function(a){"disabled"===a?this.CodeMirrorObj.setOption("readOnly",!1):this._super(a)},disable:function(a){"disabled"===a?this.CodeMirrorObj.setOption("readOnly","nocursor"):this._super(a)}});c.CheckboxControl=c.OptionControl.extend({},{getValue:function(){return 1<this.element.length?this.element.filter(":checked").map(function(a,b){return d(b).val()}).get():this.element.is(":checked")},setValue:function(a,b){var c=this;this.element.attr("checked",
!1);d.isArray(a)?d.each(a,function(a,b){c.element.filter('[value="'+b+'"]').attr("checked",!0)}):this.element.attr("checked",a);"undefined"!==typeof b&&b||this.element.change()},fixValueType:function(a){if(this.isMultiValue)return a;switch(typeof a){case "string":return 1==a;case "boolean":return a;default:return Boolean(a)}}});c.SelectControl=c.OptionControl.extend({},{dynamicList:{},relatedCtrl:{},relatedEl:{},listAttrSettings:{},init:function(a,b){this._super(a,b);this.dynamicList={};this.relatedCtrl=
{};this.relatedEl={};b=c.Vars[this.containerType].options[this.getName()];this.listAttrSettings="undefined"===typeof b?null:b.listAttrSettings;can.bind.call(this.form,"initFinish",this.proxy("initFinish"))},initFinish:function(){this.settings.hasOwnProperty("dynamicList")&&(this.dynamicList=this.settings.dynamicList,this.relatedCtrl=this.helpers[this.dynamicList.parameter],this.relatedEl=this.relatedCtrl.element,this.relatedEl.on("change silentChange",this.proxy("onRelatedChange")),can.trigger(this.relatedEl,
"change silentChange"))},onRelatedChange:function(a){a=d(a.target).find("option:selected");var b=[];a.length&&(a=a.attr(this.dynamicList.attr),a=this.parseAttr(a,this.relatedCtrl.listAttrSettings[this.dynamicList.attr]),d.each(a,function(a,c){b.push(d("<option>",{value:c.key,text:c.value}))}));this.element.html(b)},parseAttr:function(a,b){if("undefined"===typeof a||!a)return[];switch(b.type){case "split":a=a.split(b.delimiter);d.each(a,function(b,c){c&&(a[b]={key:c,value:"string"===typeof c?c[0].toUpperCase()+
c.substr(1):c})});break;case "json":a=JSON.parse(a)}return a},setElement:function(a){this.element=a.find("select")},keydown:function(a,b){this.element.change()}});c.FontPickerControl=c.SelectControl.extend({},{ladedClass:"mpsl-font-loaded",init:function(a,b){this._super(a,b);this.element.on("silentChange",this.proxy("onSilentChange"))},change:function(){this._super();this.loadFont(this.element.find("option:selected"))},onSilentChange:function(){this.loadFont(this.element.find("option:selected"))},
loadFont:function(a){if(a.length&&!a.hasClass(this.ladedClass)){var b=a.val(),c=a.attr("data-variants");if("undefined"!==typeof c){var f=[],c=this.parseAttr(c,this.listAttrSettings["data-variants"]);d.each(c,function(a,b){b.key="normal"===b.key?"regular":b.key;f.push(b.key);b.key="regular"===b.key?"italic":b.key+"italic";f.push(b.key)});f=f.join(",");b=d("<link/>",{rel:"stylesheet",type:"text/css","class":"mpsl-admin-font-link",href:"//fonts.googleapis.com/css?family="+b+(f?":"+f:"")});d("head").append(b);
a.addClass(this.ladedClass)}}}});c.RadioGroupControl=c.OptionControl.extend({},{getValue:function(){return this.element.filter(":checked").val()},setValue:function(a,b){this.element.attr("checked",!1);this.element.filter('[value="'+a+'"]').attr("checked",!0);"undefined"!==typeof b&&b||this.element.change()}});c.RadioButtonsControl=c.RadioGroupControl.extend({},{init:function(a,b){this._super(a,b);this.element.parent().buttonset()},setValue:function(a,b){this.element.attr("checked",!1).next("label").removeClass("button-primary");
this.element.filter('[value="'+a+'"]').attr("checked",!0).next("label").addClass("button-primary");"undefined"!==typeof b&&b||this.element.change()},change:function(a,b){c.OptionControl.prototype.change.apply(this,arguments);this.element.next("label").removeClass("button-primary");this.element.filter(":checked").next("label").addClass("button-primary")}});c.ButtonGroupControl=c.OptionControl.extend({},{setElement:function(a){this.element=a.find("button")},getValue:function(){return this.element.filter(".active").val()},
setValue:function(a,b){this.element.removeClass("active").filter('[value="'+a+'"]').addClass("active");"undefined"!==typeof b&&b||this.element.change()},".button click":function(a){this.element.removeClass("active");a.addClass("active");this.change()}});c.ActionGroupControl=c.OptionControl.extend({},{getValue:function(){return""},setValue:function(a,b){"undefined"!==typeof b&&b||this.element.change()},".actions > a click":function(a){d.each(this.actions[a.attr("value")],function(a,c){c.ctrl.setValue(c.value)});
this.change()}});c.AliasControl=c.OptionControl.extend({},{verifyOption:function(){var a=!1,a=this.getValue();(new RegExp(/^[-_a-zA-Z0-9]{1,250}$/)).test(a)?a=!0:(this.showError(c.Vars.lang.aliasNotValidPattern),a=!1);return a}});c.ImageLibraryControl=c.OptionControl.extend({defaults:{id:"mpsl-media-library",multiple:!1,describe:!1,toolbar:"select",sidebar:"settings",content:"upload",router:"browse",menu:"default",searchable:!0,filterable:!1,sortable:!1,title:"tmp Title",button:{text:"tmp Text"},
library:{type:"image"},contentUserSetting:!0,syncSelection:!0}},{frame:null,init:function(a,b){this._super(a,b);this.frame=wp.media({id:"mpsl-add-image-"+this.name,multiple:!1,describe:!1,toolbar:"select",sidebar:"settings",content:"upload",router:"browse",menu:"default",searchable:!0,filterable:!1,sortable:!1,title:this.settings.label,button:{text:this.settings.select_label},library:{type:"image"},contentUserSetting:!0,syncSelection:!0});this.frame.on("open",this.proxy("onFrameOpen"));this.frame.on("select",
this.proxy("onFrameSelect"));this.frame.on("close",this.proxy("onFrameClose"))},onFrameOpen:function(){var a=this.getValue();if(""!==a){var b=this.frame.state().get("selection"),a=wp.media.attachment(a);a.fetch();b.add(a?[a]:[])}},onFrameSelect:function(){var a=this,b=this.frame.state().get("selection").models[0].attributes;wp.media.attachment(b.id).fetch().done(function(){a.setValue(b.id,!0);d.each(a.helpers,function(){this.setValue(b.url)})})},onFrameClose:function(){},".mpsl-option-library-image-btn click":function(){this.frame.open()},
".mpsl-option-library-image-remove click":function(){this.setValue("",!0);d.each(this.helpers,function(){this.setValue("")})}});c.VideoLibraryControl=c.OptionControl.extend({},{frame:null,init:function(a,b){this._super(a,b);var c=this.settings.hasOwnProperty("button_label")?this.settings.button_label:"Add Video",c={id:"mpsl-add-video-"+this.name,multiple:!1,describe:!1,toolbar:"select",sidebar:"settings",content:"upload",router:"browse",menu:"default",searchable:!0,filterable:!1,sortable:!1,title:this.settings.label,
button:{text:c},library:{type:"video"},contentUserSetting:!0,syncSelection:!0};wp.media.attachment(this.getValue()).fetch();this.frame=wp.media(c);this.frame.on("open",this.proxy("onFrameOpen"));this.frame.on("select",this.proxy("onFrameSelect"));this.frame.on("close",this.proxy("onFrameClose"))},onFrameOpen:function(){var a=this.getValue();if(""!==a){var b=this.frame.state().get("selection"),a=wp.media.attachment(a);a.fetch();b.add(a?[a]:[])}},onFrameSelect:function(){var a=this.frame.state().get("selection").models[0].attributes;
wp.media.attachment(a.id).fetch();this.setValue(a.id)},onFrameClose:function(){},".mpsl-option-library-video-btn click":function(){this.frame.open()}});c.ImageUrlControl=c.OptionControl.extend({},{".mpsl-option-image-load-btn click":function(){this.change()}});c.ShortcodeControl=c.OptionControl.extend({},{});c.HiddenControl=c.OptionControl.extend({},{});c.AlignTableControl=c.OptionControl.extend({},{table:{},init:function(a,b){this._super(a,b);this.table=a.find(".mpsl-align-table")},setElement:function(a){this.element=
a},".mpsl-align-table a click":function(a){var b=a.attr("data-hor");a=a.attr("data-vert");var c=this.childOptions.offset_x.settings["default"],d=this.childOptions.offset_y.settings["default"];this.childOptions.hor_align.setValue(b,!0);this.childOptions.vert_align.setValue(a,!0);this.childOptions.offset_x.setValue(c,!0);this.childOptions.offset_y.setValue(d,!0);this.selectBullet(b,a);this.change()},getValue:function(){return{hor:this.childOptions.hor_align.getValue(),vert:this.childOptions.vert_align.getValue()}},
setValue:function(a,b){this.selectBullet(a.hor,a.vert);"undefined"!==typeof b&&b||this.element.change()},selectBullet:function(a,b){this.table.find("a.selected").removeClass("selected").end().find('a[data-hor="'+a+'"][data-vert="'+b+'"]').addClass("selected")}});c.DatePicker=c.OptionControl.extend({},{init:function(a,b){this._super(a,b);this.element.datepicker({dateFormat:"dd-mm-yy 00:00"})},verifyOption:function(){var a=this.getValue();if(""===a)return!0;a=a.match(new RegExp(/^(\d{2})-(\d{2})-(\d{4})\s(\d{2}):(\d{2})$/));
return null===a?(this.showError(c.Vars.lang.validate_invalid_date_format.replace("%s",this.getLabel())),!1):1>a[1]||31<a[1]?(this.showError(c.Vars.lang.validate_invalid_day.replace("%s",this.getLabel()).replace("%day",a[1])),!1):1>a[2]||12<a[2]?(this.showError(c.Vars.lang.validate_invalid_month.replace("%s",this.getLabel()).replace("%month",a[2])),!1):1970>a[3]||2037<a[3]?(this.showError(c.Vars.lang.validate_invalid_year.replace("%s",this.getLabel()).replace("%year",a[3]).replace("%minYear",1970).replace("%maxYear",
2037)),!1):0>a[4]||23<a[4]?(this.showError(c.Vars.lang.validate_invalid_hour.replace("%s",this.getLabel()).replace("%hour",a[4])),!1):0>a[5]||59<a[5]?(this.showError(c.Vars.lang.validate_invalid_minute.replace("%s",this.getLabel()).replace("%minute",a[5])),!1):!0}});c.StyleEditorControl=c.OptionControl.extend({},{editorEl:null,init:function(a,b){this._super(a,b);this.editorEl=d("#mpsl-style-editor-modal");this.input=a.children(".mpsl-layer-style-value");this.list=a.children(".mpsl-layer-style-list");
this.globalListEl=d("#mpsl-layer-preset-list-child-wrapper");this.addPreset("",c.Vars.lang.none,"head");can.bind.call(this.editorEl,"create",this.proxy("onEditorCreate"));can.bind.call(this.globalListEl,"presetAdd",this.proxy("onPresetAdd"));can.bind.call(this.globalListEl,"presetRemove",this.proxy("onPresetRemove"));can.bind.call(this.globalListEl,"presetUpdate",this.proxy("onPresetUpdate"))},onEditorCreate:function(a,b){b.linkControl(this)},addPreset:function(a,b,c){c&&(a=d("<option>",{value:a,
text:b}),"head"===c?this.list.find("optgroup:first").before(a):this.list.find(".mpsl-layer-style-list-group-"+c).append(a))},onPresetAdd:function(a,b){var d=null;switch(b.preset.getType()){case c.LayerPreset.PRIVATE:d="head";break;case c.LayerPreset.CUSTOM:d="custom";break;case c.LayerPreset.DEFAULT:d="default"}d&&this.addPreset(b.name,b.isPrivate?c.Vars.lang.layer_preset_private_name:b.label,d)},onPresetRemove:function(a,b){this.list.find('[value="'+b.name+'"]').remove()},onPresetUpdate:function(a,
b){this.list.find('[value="'+b.name+'"]').text(b.label)},selectPreset:function(a){this.list.find('[value="'+a+'"]').attr("selected","selected")},"> .mpsl-edit-layer-style click":function(){this.editorEl.dialog("open")},"> .mpsl-remove-layer-style click":function(){this.setValue("")},"> .mpsl-layer-style-list change":function(){var a=this.list.find("option:selected").val();this.setValue(a);can.trigger(this.globalListEl,"presetSelect",[a])},getValue:function(){return this.input.val()},setValue:function(a,
b){this.input.val(a);this.selectPreset(a);"undefined"!==typeof b&&b||this.element.change()}});c.ColorPickerControl=c.OptionControl.extend({},{colorPickerEl:null,init:function(a,b){this._super(a,b);var e=d(),e="preset"===this.containerType?this.element.closest(".mpsl-style-editor-content"):this.element.closest(".mpsl-option-wrapper");this.colorPickerEl=this.element.spectrum({appendTo:e,cancelText:c.Vars.lang.cancel,chooseText:c.Vars.lang.choose,color:"",allowEmpty:!0,showInput:!0,showAlpha:!0,preferredFormat:"hex3"})},
getValue:function(){var a=this.colorPickerEl.spectrum("get");return a?a.toRgbString():""},setValue:function(a,b){this.colorPickerEl.spectrum("set",a);"undefined"!==typeof b&&b||this.element.change()},enable:function(a){"disabled"===a?this.colorPickerEl.spectrum("enable"):this._super(a)},disable:function(a){"disabled"===a?this.colorPickerEl.spectrum("disable"):this._super(a)}});c.MultipleControl=c.OptionControl.extend({},{setElement:function(a){this.element=a.find("textarea")},getValue:function(){return JSON.parse(this._super())},
setValue:function(a,b){this._super(JSON.stringify(a),b)}});c.TextShadowControl=c.OptionControl.extend({},{init:function(a,b){this._super(a,b)},setElement:function(a){this.element=a},getValue:function(){var a=this.childOptions.text_shadow_hor_len.getValue(),b=this.childOptions.text_shadow_vert_len.getValue(),c=this.childOptions.text_shadow_radius.getValue(),d=this.childOptions.text_shadow_color.getValue();if(""===a&&""===b&&""===c&&""===d)return"";a=(a?a:0)+this.childOptions.text_shadow_hor_len.settings.unit;
b=(b?b:0)+this.childOptions.text_shadow_vert_len.settings.unit;c=(c?c:0)+this.childOptions.text_shadow_radius.settings.unit;return[a,b,c,d].join(" ")},setValue:function(a,b){"undefined"!==typeof b&&b?can.trigger(this.element,"silentChange"):this.element.change()}});c.AnimationControl=c.OptionControl.extend({},{editorEl:null,previewEl:null,animation:null,duration:null,timingFunction:null,startAnimation:null,init:function(a,b){this._super(a,b);this.editorEl=d("#mpsl-animation-"+this.name);this.previewEl=
this.editorEl.find(".mpsl-animation-preview-wrapper");this.previewEl[0].addEventListener("animationend",function(){d(this).attr("class","mpsl-animation-preview-wrapper mpsl-animated")},!1);can.bind.call(this.form,"initFinish",this.proxy("formInitFinish"))},formInitFinish:function(){var a=this;this.animation=this.getChildOption("animation");this.duration=this.getChildOption("duration");this.timingFunction=this.getChildOption("timing_function");this.editorEl.dialog({resizable:!1,draggable:!1,autoOpen:!1,
modal:!0,width:1E3,height:d(window).height()/1.7,title:c.Vars.lang["animation-modal"],closeText:"",dialogClass:"mpsl-animation-editor-dialog",position:{my:"center",at:"center",of:window},open:function(b){d("body").css("overflow","hidden");a.fixDialog();a.applyAnimation()},beforeClose:function(){d("body").css("overflow","inherit")}});"end"===this.settings.animation_type&&(this.startAnimation=this.animation.helpers.end_animation.helpers.start_animation);this.editorEl.find(".mpsl-animation-apply").on("click",
this.proxy("applyValues"));this.editorEl.find(".mpsl-animation-close").on("click",function(){a.editorEl.dialog("close")});this.editorEl.find(".mpsl-play-animation").on("click",this.proxy("applyAnimation"));this.animation.on("change",this.proxy("applyAnimation"));this.duration.on("change",this.proxy("applyAnimation"));this.timingFunction.on("change",this.proxy("applyAnimation"));d(window).on("resize",this.proxy("onWindowResize"))},getChildOption:function(a){return this.childOptions[this.settings.animation_type+
"_"+a+"_clone"]},applyAnimation:function(){var a="auto"===this.animation.getValue()?this.startAnimation.getValue().replace("In","Out"):this.animation.getValue(),b=this.duration.getValue(),c=this.timingFunction.getValue();this.previewEl.css({"-webkit-animation-duration":b+"ms","animation-duration":b+"ms"});this.previewEl.attr("class","mpsl-animation-preview-wrapper mpsl-animated");this.previewEl.addClass(" mpsl-"+a+" mpsl-"+c)},applyValues:function(){if(!this.verifyCloneValues())return!1;d.each(this.childOptions,
function(a,b){d.each(b.helpers,function(a,c){c.setValue(b.getValue())})});this.editorEl.dialog("close")},loadValues:function(){d.each(this.childOptions,function(a,b){d.each(b.helpers,function(a,c){b.setValue(c.getValue())})})},verifyOriginalValues:function(){var a=!0;d.each(this.childOptions,function(b,c){d.each(c.helpers,function(b,c){if(!c.verifyOption())return a=!1});if(!a)return!1});return a},verifyCloneValues:function(){var a=!0;d.each(this.childOptions,function(b,c){if(!c.verifyOption())return a=
!1;if(!a)return!1});return a},".mpsl-edit-animation-btn click":function(){this.verifyOriginalValues()&&(this.loadValues(),this.editorEl.dialog("open"))},setElement:function(a){this.element=a},getValue:function(){return!1},setValue:function(){},change:function(){},onWindowResize:function(){this.editorEl.dialog("isOpen")&&this.fixDialog()},fixDialog:function(){var a=d(window).height()/1.7;178<a&&(this.editorEl.dialog("option","height",0<a?a:0),this.editorEl.dialog("option","position",{my:"center",at:"center",
of:window}))}});c.PrettySelectControl=c.OptionControl.extend({},{setElement:function(a){this.element=a.find("ul")},setValue:function(a){this.setActive(this.element.find('li[data-value="'+a+'"]'))},getValue:function(){return this.element.find("li.active").attr("data-value")},setActive:function(a){a.addClass("active").siblings().removeClass("active")},"li click":function(a){this.setActive(a);this.element.change()}})})(jQuery,MPSL);
